<section class="space-y-6">

  <!-- HEADER -->
  <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4">
    <div>
      <h2 class="text-xl sm:text-2xl font-extrabold tracking-tight">
        Products
      </h2>
      <p class="text-sm text-neutral-500 mt-1">
        Manage products, stock & visibility
      </p>
    </div>

    <a
      href="/admin/products/add"
      class="px-5 py-2.5 bg-black text-white rounded-xl text-sm
             hover:bg-neutral-800 transition w-fit"
    >
      + Add Product
    </a>
  </div>

  <!-- TABLE -->
  <div class="overflow-x-auto border border-neutral-200 rounded-2xl bg-white">
    <table class="w-full text-sm">
      <thead class="bg-neutral-100 text-neutral-600">
        <tr>
          <th class="px-3 sm:px-5 py-4 text-left">
            Product
          </th>
          <th class="px-3 sm:px-5 py-4 text-left hidden md:table-cell">
            Price
          </th>
          <th class="px-3 sm:px-5 py-4 text-center">
            Stock
          </th>
          <th class="px-3 sm:px-5 py-4 text-center hidden md:table-cell">
            Status
          </th>
          <th class="px-3 sm:px-5 py-4 text-right">
            Actions
          </th>
        </tr>
      </thead>

      <tbody class="divide-y">

        <% if (products.length === 0) { %>
          <tr>
            <td colspan="5" class="px-6 py-14 text-center text-neutral-500">
              No products found.
            </td>
          </tr>
        <% } %>

        <% products.forEach(product => { %>
          <tr class="hover:bg-neutral-50 transition align-top">

            <!-- PRODUCT -->
            <td class="px-3 sm:px-5 py-4">
              <div class="flex gap-3">
                <% if (product.images?.[0]) { %>
                  <img
                    src="<%= product.images[0].url %>"
                    class="w-12 h-12 sm:w-14 sm:h-14 rounded-xl object-cover border"
                  />
                <% } else { %>
                  <div class="w-12 h-12 rounded-xl bg-neutral-200 flex items-center justify-center text-xs">
                    N/A
                  </div>
                <% } %>

                <div>
                  <p class="font-semibold leading-tight">
                    <%= product.name %>
                  </p>

                  <p class="text-xs text-neutral-500 mt-0.5">
                    <%= product.categories?.join(", ") || "â€”" %>
                  </p>

                  <!-- PRICE (MOBILE) -->
                  <div class="mt-1 md:hidden text-xs">
                    <% if (product.salePrice) { %>
                      <span class="font-semibold">
                        â‚¹<%= product.salePrice %>
                      </span>
                      <span class="ml-1 text-neutral-400 line-through">
                        â‚¹<%= product.price %>
                      </span>
                    <% } else { %>
                      <span class="font-semibold">
                        â‚¹<%= product.price %>
                      </span>
                    <% } %>
                  </div>

                  <% if (product.totalStock <= 5) { %>
                    <p class="mt-1 text-xs text-red-600 font-medium">
                      ðŸ”” Low stock
                    </p>
                  <% } %>
                </div>
              </div>
            </td>

            <!-- PRICE (DESKTOP) -->
            <td class="px-3 sm:px-5 py-4 hidden md:table-cell">
              <% if (product.salePrice) { %>
                <p class="font-semibold">
                  â‚¹<%= product.salePrice %>
                </p>
                <p class="text-xs text-neutral-400 line-through">
                  â‚¹<%= product.price %>
                </p>
              <% } else { %>
                <p class="font-semibold">
                  â‚¹<%= product.price %>
                </p>
              <% } %>
            </td>

            <!-- STOCK -->
            <td class="px-3 sm:px-5 py-4 text-center">
              <form
                action="/admin/products/<%= product._id %>/stock"
                method="POST"
                class="space-y-1"
              >

                <% product.variants.forEach((v, index) => { %>
                  <div class="flex items-center justify-center gap-2">
                    <span class="text-xs text-neutral-500 w-8 text-right">
                      <%= v.size %>
                    </span>

                    <input
                      type="number"
                      name="stock[<%= index %>]"
                      value="<%= v.stock %>"
                      min="0"
                      class="w-14 px-2 py-1 text-center text-xs
                             border rounded-lg focus:outline-none
                             focus:ring-1 focus:ring-black"
                    />
                  </div>
                <% }) %>

                <button
                  type="submit"
                  class="mt-1 text-xs text-blue-600 hover:underline"
                >
                  Update
                </button>
              </form>
            </td>

            <!-- STATUS (DESKTOP ONLY) -->
            <td class="px-3 sm:px-5 py-4 text-center hidden md:table-cell">
              <span class="px-2.5 py-1 text-xs rounded-full
                <%= product.status === 'active'
                  ? 'bg-green-100 text-green-700'
                  : product.status === 'draft'
                  ? 'bg-yellow-100 text-yellow-700'
                  : 'bg-neutral-200 text-neutral-600' %>">
                <%= product.status %>
              </span>
            </td>

            <!-- ACTIONS -->
            <td class="px-3 sm:px-5 py-4 text-right">
              <div class="flex justify-end gap-3 text-sm">

                <a
                  href="/admin/products/<%= product._id %>/view"
                  class="text-neutral-600 hover:text-black hover:underline"
                >
                  View
                </a>

                <form
                  action="/admin/products/<%= product._id %>/delete"
                  method="POST"
                  onsubmit="return confirm('Delete this product?')"
                >
                  <button
                    type="submit"
                    class="text-red-600 hover:underline"
                  >
                    Delete
                  </button>
                </form>

              </div>
            </td>

          </tr>
        <% }) %>

      </tbody>
    </table>
  </div>

</section>
