<% layout('layout') -%>
<section class="max-w-3xl mx-auto p-6">
  <h2 class="text-2xl font-bold mb-4">Edit Product</h2>
  <% if (error) { %><p class="text-red-600 mb-3"><%= error %></p><% } %>

  <form action="/admin/products/<%= product._id %>/edit" method="post" enctype="multipart/form-data" class="space-y-4">
    <input name="name" value="<%= product.name %>" placeholder="Product name" required class="w-full border p-2" />
    <input name="price" value="<%= product.price %>" placeholder="Price" required class="w-full border p-2" />
    <input name="salePrice" value="<%= product.salePrice %>" placeholder="Sale Price (optional)" class="w-full border p-2" />
    <input name="categories" value="<%= product.categories.join(',') %>" placeholder="Categories (comma separated)" class="w-full border p-2" />
    <input name="tags" value="<%= product.tags.join(',') %>" placeholder="Tags (comma separated)" class="w-full border p-2" />
    <input name="sizes" value="<%= product.variants.map(v=>v.size).join(',') %>" placeholder="Sizes (comma separated, e.g. S,M,L)" class="w-full border p-2" />
    <textarea name="description" class="w-full border p-2"><%= product.description %></textarea>

    <div>
      <label class="block mb-2">Current Images</label>
      <div class="flex gap-2">
        <% (product.images || []).forEach(img => { %>
          <div>
            <img src="<%= img.url %>" class="w-28 h-28 object-cover rounded" />
            <form action="/admin/products/image/delete" method="post">
              <input type="hidden" name="productId" value="<%= product._id %>" />
              <input type="hidden" name="publicId" value="<%= img.public_id %>" />
              <button class="mt-2 px-2 py-1 border">Delete</button>
            </form>
          </div>
        <% }) %>
      </div>
    </div>

    <label class="block">Upload new images</label>
    <input type="file" name="images" multiple accept="image/*" />

    <div>
      <button class="px-4 py-2 bg-black text-white">Save Product</button>
      <a href="/admin/products" class="ml-3">Cancel</a>
    </div>
  </form>
</section>
